steps:
  # Install Go (if needed)
  - name: 'golang:1.20'
    entrypoint: 'go'
    args: ['version']

  # Install GoReleaser
  - name: 'golang:1.20'
    entrypoint: 'go'
    args: ['install', 'github.com/goreleaser/goreleaser@latest']
    env:
      - 'GO111MODULE=on'

  # Run GoReleaser
  - name: 'golang:1.20'
    entrypoint: 'goreleaser'
    args: ['release', '--rm-dist']
    env:
      - 'GOPATH=/workspace/go'
      - 'GOBIN=/workspace/go/bin'
      - 'GITHUB_REF=refs/tags/${_TAG_NAME}'

  # Upload artifacts to Google Cloud Storage
  - id: “Upload dist to storage“
    name: 'gcr.io/google.com/cloudsdktool/cloud-sdk:slim'
    automapSubstitutions: true
    script: |
      #!/usr/bin/env bash
      if [ ! -z "$TAG_NAME" ]; then
        gcloud storage cp ./dist/* gs://dev-docs-releases/dist

# Set the timeout for the build (optional)
timeout: '1800s'
build:
  logging: CLOUD_LOGGING_ONLY

# Substitutions
substitutions:
  _BUCKET_NAME: your-bucket-name  # Default value, can be overridden
  _TAG_NAME: v0.0.0  # Default value, should be overridden when triggering the build

# You can specify options here
options:
  env:
    - 'PATH=/workspace/go/bin:$$PATH'